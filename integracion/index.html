<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FERREMAS - Panel de AdministraciÃ³n</title>
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(120deg, #2980b9, #6dd5fa);
      background-size: 400% 400%;
      animation: gradientBG 10s ease infinite;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding-top: 40px;
      color: #222;
    }

    @keyframes gradientBG {
      0% {background-position: 0% 50%;}
      50% {background-position: 100% 50%;}
      100% {background-position: 0% 50%;}
    }

    .container {
      background: #fff;
      padding: 35px 50px;
      border-radius: 15px;
      box-shadow: 0 15px 40px rgba(0,0,0,0.25);
      max-width: 1000px;
      width: 95%;
      opacity: 1;
    }

    h1 {
      text-align: center;
      font-size: 2.5rem;
      color: #2c3e50;
      letter-spacing: 4px;
      margin-bottom: 10px;
    }

    .welcome, .role-display {
      text-align: center;
      font-size: 1.2rem;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .role-display {
      color: #fff;
      background: #2980b9;
      display: inline-block;
      padding: 6px 20px;
      border-radius: 25px;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 30px;
    }

    .menu {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 16px;
      margin-bottom: 30px;
    }

    .menu button {
      background: linear-gradient(145deg, #3498db, #2980b9);
      border: none;
      color: #fff;
      padding: 14px 24px;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 40px;
      box-shadow: 0 8px 20px rgba(41,128,185,0.5);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .menu button:hover {
      transform: translateY(-4px);
      background: linear-gradient(145deg, #2572a8, #1b4e73);
      box-shadow: 0 10px 25px rgba(20,90,140,0.6);
    }

    .menu button:active {
      transform: scale(0.98);
    }

    .menu button.logout {
      background: linear-gradient(145deg, #e74c3c, #c0392b);
    }

    .menu button.logout:hover {
      background: linear-gradient(145deg, #b93223, #962417);
    }

    section, #cart-container {
      display: none;
      background: #f4f8ff;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 25px;
      box-shadow: inset 0 0 10px #d0e4f5;
    }

    pre {
      background: #1e1e1e;
      color: #eee;
      padding: 15px;
      border-radius: 10px;
      font-family: monospace;
      overflow-x: auto;
    }

    @media (max-width: 768px) {
      .menu {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>FERREMAS</h1>
    <div class="welcome" id="welcome-msg">Cargando...</div>
    <div class="role-display" id="role-display">Invitado</div>

    <div class="menu">
      <button onclick="showProducts()">CatÃ¡logo</button>
      <button onclick="showProduct()">Productos en venta</button>
      <button onclick="getBranches()">Sucursales</button>
      <button onclick="showBranch()">Sucursal</button>
      <button onclick="showVendors()">Vendedores</button>
      <button onclick="showVendor()">Vendedor</button>
      <button onclick="showOrderForm()">Pedidos</button>
      <button class="logout" onclick="logout()">Cerrar sesiÃ³n</button>
    </div>

    <section id="catalog-section"></section>
    <section id="form-section"></section>
    <section id="response-section"><pre id="output"></pre></section>

    <div id="cart-container">
      <h3>ðŸ›’ Carrito</h3>
      <div id="cart-items"></div>
      <p>Total: $<span id="cart-total">0</span> <span id="currency">CLP</span></p>
      <select id="currency-select" onchange="updateCurrency()">
        <option value="CLP">CLP</option>
        <option value="USD">USD</option>
      </select>
      <button onclick="pay()">Pagar</button>
      <p id="pay-status"></p>
    </div>
  </div>

  <script>
    const roleDisplay = document.getElementById('role-display');
    const welcomeMsg = document.getElementById('welcome-msg');
    const buttons = document.querySelectorAll('.menu button');
    let cart = [];

    function getGreeting() {
      const hour = new Date().getHours();
      if (hour < 12) return "ðŸŒ… Â¡Buenos dÃ­as!";
      if (hour < 19) return "ðŸŒž Â¡Buenas tardes!";
      return "ðŸŒ™ Â¡Buenas noches!";
    }

    window.addEventListener('load', () => {
      const role = localStorage.getItem('role') || 'Invitado';
      roleDisplay.textContent = role.toUpperCase();
      welcomeMsg.textContent = `${getGreeting()} Bienvenido(a), ${role.toLowerCase()} de FERREMAS`;

      if (role === 'maintainer') {
        document.querySelector('button[onclick="showVendors()"]').style.display = 'none';
        document.querySelector('button[onclick="showVendor()"]').style.display = 'none';
      } else if (role === 'service_account') {
        buttons.forEach(btn => {
          const text = btn.textContent.toLowerCase();
          if (!text.includes('catÃ¡logo') && !text.includes('producto')) {
            btn.style.display = 'none';
          }
        });
      } else if (role !== 'admin') {
        alert("Rol no autorizado");
        logout();
      }
    });

    function logout() {
      localStorage.clear();
      window.location.href = '/';
    }

    function hideAllSections() {
      document.querySelectorAll('section, #cart-container').forEach(e => e.style.display = 'none');
    }

    async function showProducts() {
      hideAllSections();
      const catalogSection = document.getElementById('catalog-section');
      catalogSection.style.display = 'block';
      catalogSection.innerHTML = '<p>Cargando productos...</p>';

      try {
        const response = await fetch('../db/productos.json'); // Ruta ajustada
        const products = await response.json();

        let html = '<h2>CatÃ¡logo de Productos</h2><ul>';
        products.forEach((p, i) => {
          html += `
            <li>
              <strong>${p.nombre}</strong> - $${p.precio.toLocaleString()} - Stock: ${p.stock}<br>
              Cantidad: <input type="number" id="qty-${i}" min="1" max="${p.stock}" value="1" style="width: 60px;">
              <button onclick="addToCart('${p.nombre}', ${p.precio}, ${p.stock}, 'qty-${i}')">Agregar al carrito</button>
            </li><br>`;
        });
        html += '</ul>';
        catalogSection.innerHTML = html;
      } catch (error) {
        catalogSection.innerHTML = `<p>Error cargando productos: ${error.message}</p>`;
      }
    }

    function addToCart(nombre, precio, stock, inputId) {
      const cantidad = parseInt(document.getElementById(inputId).value);
      if (cantidad < 1 || cantidad > stock) {
        alert("Cantidad no vÃ¡lida");
        return;
      }

      const existente = cart.find(p => p.nombre === nombre);
      if (existente) {
        if (existente.cantidad + cantidad > stock) {
          alert("Supera el stock");
          return;
        }
        existente.cantidad += cantidad;
      } else {
        cart.push({ nombre, precio, cantidad });
      }

      actualizarCarrito();
    }

    function actualizarCarrito() {
      const cartItems = document.getElementById('cart-items');
      const cartTotal = document.getElementById('cart-total');
      let total = 0;

      let html = '<ul>';
      cart.forEach(p => {
        const subtotal = p.precio * p.cantidad;
        html += `<li>${p.nombre} x${p.cantidad} â†’ $${subtotal.toLocaleString()}</li>`;
        total += subtotal;
      });
      html += '</ul>';

      cartItems.innerHTML = html;
      cartTotal.textContent = total.toLocaleString();
      document.getElementById('cart-container').style.display = 'block';
    }

    function showProduct() {
      hideAllSections();
      document.getElementById('form-section').style.display = 'block';
      document.getElementById('form-section').textContent = 'Formulario de productos en venta...';
    }

    function getBranches() {
      hideAllSections();
      document.getElementById('response-section').style.display = 'block';
      document.getElementById('output').textContent = 'Listado de sucursales cargÃ¡ndose...';
    }

    function showBranch() {
      hideAllSections();
      document.getElementById('response-section').style.display = 'block';
      document.getElementById('output').textContent = 'Detalle sucursal cargÃ¡ndose...';
    }

    function showVendors() {
      hideAllSections();
      document.getElementById('response-section').style.display = 'block';
      document.getElementById('output').textContent = 'Listado de vendedores cargÃ¡ndose...';
    }

    function showVendor() {
      hideAllSections();
      document.getElementById('response-section').style.display = 'block';
      document.getElementById('output').textContent = 'Detalle vendedor cargÃ¡ndose...';
    }

    function showOrderForm() {
      hideAllSections();
      document.getElementById('form-section').style.display = 'block';
      document.getElementById('form-section').textContent = 'Formulario para pedidos...';
      document.getElementById('cart-container').style.display = 'block';
    }

    function updateCurrency() {
      const currency = document.getElementById('currency-select').value;
      document.getElementById('currency').textContent = currency;
    }

    function pay() {
      const payStatus = document.getElementById('pay-status');
      payStatus.textContent = "Procesando pago...";
      setTimeout(() => {
        payStatus.textContent = "âœ… Pago realizado con Ã©xito";
      }, 1500);
    }
  </script>
</body>
</html>
